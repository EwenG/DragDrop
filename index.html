<html>
    <head>
        <style type="text/css">
        </style>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Dragdrop examples</title>

        <!-- Bootstrap -->
        <link href="resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>

        <div class="container-fluid">
            <div class="row">
                <div class="col-md-6">
                    <h4>Typical drag and drop</h4>
                    <pre class="pre-scrollable">
(defn typical-draggable [cursor owner]
  (reify
    om/IDidMount
    (did-mount [_ node]
               (let [dims (-> (om/get-node owner "typical-draggable")
                              gstyle/getSize gsize->vec)]
                 (om/set-state! owner :dimensions dims))
               (let [[up-events up-unlisten] (dd/extract-events :up)
                     [down-events down-unlisten] (dd/extract-events node :down)
                     [move-events move-unlisten] (dd/extract-events :move)
                     dd-events (dd/create-dd down-events move-events up-events)]
                 (om/set-state! owner :unlisten (comp up-unlisten
                                                      down-unlisten
                                                      move-unlisten))
                 (om/set-state! owner :dd-events dd-events)

                 (->> (F-cljs/filterE #(:handle %) dd-events)
                      (F-cljs/mapE (fn [{:keys [left top]}]
                                     (om/set-state! owner :dragging true)
                                     (om/set-state! owner :location [left top]))))

                 (->> (F-cljs/filterE #(:drag %) dd-events)
                      (F-cljs/mapE (fn [{:keys [left top]}]
                                     (om/set-state! owner :location [left top]))))

                 (->> (F-cljs/filterE #(:drop %) dd-events)
                      (F-cljs/mapE #(om/set-state! owner :dragging false)))))
    om/IWillUnmount
    (will-unmount [_ _]
                  ((om/get-state! owner :unlisten)))
    om/IRenderState
    (render-state [_ state]
                  (let [style (cond
                               (dragging? owner)
                               (let [[x y] (:location state)
                                     [w h] (:dimensions state)]
                                 (js-obj "position" "absolute"
                                         "top" (- y (/ h 2))
                                         "left" (- x (/ w 2))
                                         "z-index" 1
                                         "width" w "height" h))
                               :else
                               (js-obj "position" "static" "z-index" 0))]
                    (dom/div
                     (js-obj "className" (if (dragging? owner)
                                           "well dragging"
                                           "well")
                             "style" style
                             "ref" "typical-draggable")
                     "Drag me!")))))
                    </pre>
                    <div id="typical-dd"></div>
                </div>
                <div class="col-md-6">
                    <h4>Delayed drag and drop</h4>
                    <pre class="pre-scrollable">
(defn delayed-draggable [cursor owner]
  (reify
    om/IDidMount
    (did-mount [_ node]
               (let [dims (-> (om/get-node owner "delayed-draggable")
                              gstyle/getSize gsize->vec)]
                 (om/set-state! owner :dimensions dims))
               (let [[up-events up-unlisten] (dd/extract-events :up)
                     [down-events down-unlisten] (dd/extract-events node :down)
                     [move-events move-unlisten] (dd/extract-events :move)
                     dd-events (dd/create-dd down-events
                                             (-> move-events
                                                 <font color="red">(F-cljs/delayE (F-cljs/constantB 500))</font>)
                                             up-events)]
                 (om/set-state! owner :unlisten (comp up-unlisten
                                                      down-unlisten
                                                      move-unlisten))
                 (om/set-state! owner :dd-events dd-events)

                 (->> (F-cljs/filterE #(:handle %) dd-events)
                      (F-cljs/mapE (fn [{:keys [left top]}]
                                     (om/set-state! owner :dragging true)
                                     (om/set-state! owner :location [left top]))))

                 (->> (F-cljs/filterE #(:drag %) dd-events)
                      (F-cljs/mapE (fn [{:keys [left top]}]
                                     (om/set-state! owner :location [left top]))))

                 (->> (F-cljs/filterE #(:drop %) dd-events)
                      (F-cljs/mapE #(om/set-state! owner :dragging false)))))
    om/IWillUnmount
    (will-unmount [_ _]
                  ((om/get-state! owner :unlisten)))
    om/IRenderState
    (render-state [_ state]
                  (let [style (cond
                               (dragging? owner)
                               (let [[x y] (:location state)
                                     [w h] (:dimensions state)]
                                 (js-obj "position" "absolute"
                                         "top" (- y (/ h 2))
                                         "left" (- x (/ w 2))
                                         "z-index" 1
                                         "width" w "height" h))
                               :else
                               (js-obj "position" "static" "z-index" 0))]
                    (dom/div
                     (js-obj "className" (if (dragging? owner)
                                           "well dragging"
                                           "well")
                             "style" style
                             "ref" "delayed-draggable")
                     "Drag me! But I'm slow!")))))
                    </pre>
                    <div id="delayed-dd"></div>
                </div>
                <div class="col-md-6">
                    <h4>Hook drag and drop</h4>
                    <pre class="pre-scrollable">
(defn hook-draggable [cursor owner]
  (reify
    om/IDidMount
    (did-mount [_ node]
               (let [dims (-> (om/get-node owner "hook-draggable")
                              gstyle/getSize gsize->vec)]
                 (om/set-state! owner :dimensions dims))
               (let [[up-events up-unlisten] (dd/extract-events :up)
                     [down-events down-unlisten] (dd/extract-events node :down)
                     [move-events move-unlisten] (dd/extract-events :move)
                     dd-events (dd/create-dd down-events
                                             move-events
                                             up-events)]
                 (om/set-state! owner :unlisten (comp up-unlisten
                                                      down-unlisten
                                                      move-unlisten))
                 (om/set-state! owner :dd-events dd-events)

                 (->> (F-cljs/filterE #(:handle %) dd-events)
                      (F-cljs/mapE (fn [{:keys [left top]}]
                                     (om/set-state! owner :dragging true)
                                     (om/set-state! owner :location [left top])
                                     <font color="red">(-> (sel "#hook-div")
                                     single-node
                                     (.-innerHTML)
                                     (set! "Handled!"))</font>)))

                 (->> (F-cljs/filterE #(:drag %) dd-events)
                      (F-cljs/mapE (fn [{:keys [left top]}]
                                     (om/set-state! owner :location [left top]))))

                 (->> (F-cljs/filterE #(:drop %) dd-events)
                      (F-cljs/mapE (fn [] (om/set-state! owner :dragging false)
                                     <font color="red">(-> (sel "#hook-div")
                                     single-node
                                     (.-innerHTML)
                                     (set! "Droped!"))</font>)))))
    om/IWillUnmount
    (will-unmount [_ _]
                  ((om/get-state! owner :unlisten)))
    om/IRenderState
    (render-state [_ state]
                  (let [style (cond
                               (dragging? owner)
                               (let [[x y] (:location state)
                                     [w h] (:dimensions state)]
                                 (js-obj "position" "absolute"
                                         "top" (- y (/ h 2))
                                         "left" (- x (/ w 2))
                                         "z-index" 1
                                         "width" w "height" h))
                               :else
                               (js-obj "position" "static" "z-index" 0))]
                    (dom/div
                     (js-obj "className" (if (dragging? owner)
                                           "well dragging"
                                           "well")
                             "id" "hook-div"
                             "style" style
                             "ref" "hook-draggable")
                     "Drag me!")))))
                    </pre>
                    <div id="hook-dd"></div>
                </div>
                <div class="col-md-6">
                    <h4>Long press drag and drop</h4>
                    <pre class="pre-scrollable">
(defn long-press-draggable [cursor owner]
  (reify
    om/IDidMount
    (did-mount [_ node]
               (let [dims (-> (om/get-node owner "long-press-draggable")
                              gstyle/getSize gsize->vec)]
                 (om/set-state! owner :dimensions dims))
               (let [[up-events up-unlisten] (dd/extract-events :up)
                     [down-events down-unlisten] (dd/extract-events node :down)
                     [move-events move-unlisten] (dd/extract-events :move)
                     dd-events (dd/create-dd <font color="red">(dd/long-press down-events up-events 1000)
                                             move-events
                                             up-events)</font>]
                 (om/set-state! owner :unlisten (comp up-unlisten
                                                      down-unlisten
                                                      move-unlisten))
                 (om/set-state! owner :dd-events dd-events)

                 (->> (F-cljs/filterE #(:handle %) dd-events)
                      (F-cljs/mapE (fn [{:keys [left top]}]
                                     (om/set-state! owner :dragging true)
                                     (om/set-state! owner :location [left top]))))

                 (->> (F-cljs/filterE #(:drag %) dd-events)
                      (F-cljs/mapE (fn [{:keys [left top]}]
                                     (om/set-state! owner :location [left top]))))

                 (->> (F-cljs/filterE #(:drop %) dd-events)
                      (F-cljs/mapE (fn [] (om/set-state! owner :dragging false))))))
    om/IWillUnmount
    (will-unmount [_ _]
                  ((om/get-state! owner :unlisten)))
    om/IRenderState
    (render-state [_ state]
                  (let [style (cond
                               (dragging? owner)
                               (let [[x y] (:location state)
                                     [w h] (:dimensions state)]
                                 (js-obj "position" "absolute"
                                         "top" (- y (/ h 2))
                                         "left" (- x (/ w 2))
                                         "z-index" 1
                                         "width" w "height" h))
                               :else
                               (js-obj "position" "static" "z-index" 0))]
                    (dom/div
                     (js-obj "className" (if (dragging? owner)
                                           "well dragging"
                                           "well")
                             "style" style
                             "ref" "long-press-draggable")
                     "Long press... Then drag me!")))))
                    </pre>
                    <div id="long-press-dd"></div>
                </div>
            </div>
        </div>




        <script src="resources/js/react-0.8.0.js" type="text/javascript"></script>
        <script src="resources/cljs/goog/base.js" type="text/javascript"></script>
        <script src="resources/cljs/dragdrop.js" type="text/javascript"></script>
        <script type="text/javascript">goog.require("ewen.async_plus");</script>
        <script type="text/javascript">goog.require("ewen.dragdrop");</script>
        <script type="text/javascript">goog.require("ewen.dragdrop.examples");</script>
        <script type="text/javascript">goog.require("ewen.dragdrop");</script>
    </body>
</html>
