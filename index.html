<html>
    <head>
        <style type="text/css">
        </style>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Dragdrop examples</title>

        <!-- Bootstrap -->
        <link href="resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>

        <div class="container-fluid">
            <div class="row">
                <div class="col-md-6">
                    <h4>Typical drag and drop</h4>
                    <pre class="pre-scrollable">
(defn typical-draggable [cursor owner]
  (reify
    om/IDidMount
    (did-mount [_ node]
               (let [dims (-&gt; (om/get-node owner "typical-draggable")
                              gstyle/getSize gsize-&gt;vec)
                     init-loc (-&gt; (om/get-node owner "typical-draggable")
                                  gstyle/getPosition gloc-&gt;vec)]
                 (om/set-state! owner :dimensions dims)
                 (om/set-state! owner :init-location init-loc))
               (let [up-events (dd/extract-events :up)
                     down-events (dd/extract-events node :down)
                     move-events (dd/extract-events :move)
                     dd-events (dd/create-dd down-events move-events up-events)]
                 (om/set-state! owner :unlisten (comp #(async+/close! up-events)
                                                      #(async+/close! down-events)
                                                      #(async+/close! move-events)))
                 (om/set-state! owner :dd-events dd-events)
                 (let [handle-events (async+/filter&lt; #(:handle %) dd-events)]
                   (async+m/go-loop [handle-ch handle-events]
                                    (when-let [{:keys [left top]}
                                               (async/&lt;! handle-ch)]
                                      (om/set-state! owner :handle-location [left top])
                                      (recur handle-ch))))
                 (let [drag-events (async+/filter&lt; #(:drag %) dd-events)]
                   (async+m/go-loop [drag-ch drag-events]
                                    (when-let [{:keys [left top]}
                                               (async/&lt;! drag-ch)]
                                      (let [[init-left init-top]
                                           (om/get-state owner :init-location)
                                           [handle-left handle-top]
                                           (om/get-state owner :handle-location)]
                                       (om/set-state! owner :dragging true)
                                       (om/set-state! owner
                                                      :location
                                                      [(+ init-left (- left handle-left))
                                                       (+ init-top (- top handle-top))]))
                                      (recur drag-ch))))
                 (let [drop-events (async+/filter&lt; #(:drop %) dd-events)]
                   (async+m/go-loop [drop-ch drop-events]
                                    (when-let [{:keys [left top]}
                                               (async/&lt;! drop-ch)]
                                      (om/set-state! owner :dragging false)
                                      (recur drop-ch))))))
    om/IWillUnmount
    (will-unmount [_]
                  ((om/get-state owner :unlisten)))
    om/IRenderState
    (render-state [_ state]
                  (let [style (cond
                               (dragging? owner)
                               (let [[x y] (:location state)
                                     [w h] (:dimensions state)]
                                 (js-obj "position" "absolute"
                                         "left" x "top" y
                                         "z-index" 1
                                         "width" w "height" h))
                               :else
                               (js-obj "position" "static" "z-index" 0))]
                    (dom/div
                     (js-obj "className" (if (dragging? owner)
                                           "well dragging"
                                           "well")
                             "style" style
                             "ref" "typical-draggable")
                     "Drag me!")))))
                    </pre>
                    <div id="typical-dd"></div>
                </div>
                <div class="col-md-6">
                    <h4>Delayed drag and drop</h4>
                    <pre class="pre-scrollable">
(defn delayed-draggable [cursor owner]
  (reify
    om/IDidMount
    (did-mount [_ node]
               (let [dims (-&gt; (om/get-node owner "delayed-draggable")
                              gstyle/getSize gsize-&gt;vec)
                     init-loc (-&gt; (om/get-node owner "delayed-draggable")
                                  gstyle/getPosition gloc-&gt;vec)]
                 (om/set-state! owner :dimensions dims)
                 (om/set-state! owner :init-location init-loc))
               (let [up-events (dd/extract-events :up)
                     down-events (dd/extract-events node :down)
                     move-events (dd/extract-events :move)
                     dd-events (dd/create-dd down-events
                               <font color="red">(async+/delay&lt; 500 move-events)</font>
                                             up-events)]
                 (om/set-state! owner :unlisten (comp #(async+/close! up-events)
                                                      #(async+/close! down-events)
                                                      #(async+/close! move-events)))
                 (om/set-state! owner :dd-events dd-events)
                 (let [handle-events (async+/filter&lt; #(:handle %) dd-events)]
                   (async+m/go-loop [handle-ch handle-events]
                                    (when-let [{:keys [left top]}
                                               (async/&lt;! handle-ch)]
                                      (om/set-state! owner :handle-location [left top])
                                      (recur handle-ch))))
                 (let [drag-events (async+/filter&lt; #(:drag %) dd-events)]
                   (async+m/go-loop [drag-ch drag-events]
                                    (when-let [{:keys [left top]}
                                               (async/&lt;! drag-ch)]
                                      (let [[init-left init-top]
                                           (om/get-state owner :init-location)
                                           [handle-left handle-top]
                                           (om/get-state owner :handle-location)]
                                       (om/set-state! owner :dragging true)
                                       (om/set-state! owner
                                                      :location
                                                      [(+ init-left (- left handle-left))
                                                       (+ init-top (- top handle-top))]))
                                      (recur drag-ch))))
                 (let [drop-events (async+/filter&lt; #(:drop %) dd-events)]
                   (async+m/go-loop [drop-ch drop-events]
                                    (when-let [{:keys [left top]}
                                               (async/&lt;! drop-ch)]
                                      (om/set-state! owner :dragging false)
                                      (recur drop-ch))))))
    om/IWillUnmount
    (will-unmount [_]
                  ((om/get-state owner :unlisten)))
    om/IRenderState
    (render-state [_ state]
                  (let [style (cond
                               (dragging? owner)
                               (let [[x y] (:location state)
                                     [w h] (:dimensions state)]
                                 (js-obj "position" "absolute"
                                         "left" x "top" y
                                         "z-index" 1
                                         "width" w "height" h))
                               :else
                               (js-obj "position" "static" "z-index" 0))]
                    (dom/div
                     (js-obj "className" (if (dragging? owner)
                                           "well dragging"
                                           "well")
                             "style" style
                             "ref" "delayed-draggable")
                     "Drag me! But i'm slow...")))))
                    </pre>
                    <div id="delayed-dd"></div>
                </div>
                <div class="col-md-6">
                    <h4>Hook drag and drop</h4>
                    <pre class="pre-scrollable">
(defn hook-draggable [cursor owner]
  (reify
    om/IDidMount
    (did-mount [_ node]
               (let [dims (-&gt; (om/get-node owner "hook-draggable")
                              gstyle/getSize gsize-&gt;vec)
                     init-loc (-&gt; (om/get-node owner "hook-draggable")
                                  gstyle/getPosition gloc-&gtvec)]
                 (om/set-state! owner :dimensions dims)
                 (om/set-state! owner :init-location init-loc))
               (let [up-events (dd/extract-events :up)
                     down-events (dd/extract-events node :down)
                     move-events (dd/extract-events :move)
                     dd-events (dd/create-dd down-events move-events up-events)]
                 (om/set-state! owner :unlisten (comp #(async+/close! up-events)
                                                      #(async+/close! down-events)
                                                      #(async+/close! move-events)))
                 (om/set-state! owner :dd-events dd-events)
                 (let [handle-events (async+/filter&lt; #(:handle %) dd-events)]
                   (async+m/go-loop [handle-ch handle-events]
                                    (when-let [{:keys [left top]}
                                               (async/&lt;! handle-ch)]
                                      (om/set-state! owner :handle-location [left top])
                                      <font color="red">(set! (.-innerHTML node) "Handled")</font>
                                      (recur handle-ch))))
                 (let [drag-events (async+/filter&lt; #(:drag %) dd-events)]
                   (async+m/go-loop [drag-ch drag-events]
                                    (when-let [{:keys [left top]}
                                               (async/&lt;! drag-ch)]
                                      (let [[init-left init-top]
                                           (om/get-state owner :init-location)
                                           [handle-left handle-top]
                                           (om/get-state owner :handle-location)]
                                       (om/set-state! owner :dragging true)
                                       (om/set-state! owner
                                                      :location
                                                      [(+ init-left (- left handle-left))
                                                       (+ init-top (- top handle-top))])
                                         <font color="red">(set! (.-innerHTML node) "Drag"))</font>
                                      (recur drag-ch))))
                 (let [drop-events (async+/filter&lt; #(:drop %) dd-events)]
                   (async+m/go-loop [drop-ch drop-events]
                                    (when-let [{:keys [left top]}
                                               (async/&lt;! drop-ch)]
                                      (om/set-state! owner :dragging false)
                                      <font color="red">(set! (.-innerHTML node) "Droped")</font>
                                      (recur drop-ch))))))
    om/IWillUnmount
    (will-unmount [_]
                  ((om/get-state owner :unlisten)))
    om/IRenderState
    (render-state [_ state]
                  (let [style (cond
                               (dragging? owner)
                               (let [[x y] (:location state)
                                     [w h] (:dimensions state)]
                                 (js-obj "position" "absolute"
                                         "left" x "top" y
                                         "z-index" 1
                                         "width" w "height" h))
                               :else
                               (js-obj "position" "static" "z-index" 0))]
                    (dom/div
                     (js-obj "className" (if (dragging? owner)
                                           "well dragging"
                                           "well")
                             "style" style
                             "ref" "hook-draggable")
                     "Drag me!")))))
                    </pre>
                    <div id="hook-dd"></div>
                </div>
                <div class="col-md-6">
                    <h4>Long press drag and drop</h4>
                    <pre class="pre-scrollable">
(defn long-press-draggable [cursor owner]
  (reify
    om/IDidMount
    (did-mount [_ node]
               (let [dims (-&gt; (om/get-node owner "long-press-draggable")
                              gstyle/getSize gsize-&gt;vec)
                     init-loc (-&gt; (om/get-node owner "long-press-draggable")
                                  gstyle/getPosition gloc-&gt;vec)]
                 (om/set-state! owner :dimensions dims)
                 (om/set-state! owner :init-location init-loc))
               (let [up-events (dd/extract-events :up)
                     down-events (dd/extract-events node :down)
                     move-events (dd/extract-events :move)
                     dd-events (dd/create-dd <font color="red">(dd/long-press down-events up-events 1000)</font> move-events up-events)]
                 (om/set-state! owner :unlisten (comp #(async+/close! up-events)
                                                      #(async+/close! down-events)
                                                      #(async+/close! move-events)))
                 (om/set-state! owner :dd-events dd-events)
                 (let [handle-events (async+/filter&lt; #(:handle %) dd-events)]
                   (async+m/go-loop [handle-ch handle-events]
                                    (when-let [{:keys [left top]}
                                               (async/&lt;! handle-ch)]
                                      (om/set-state! owner :handle-location [left top])
                                      (recur handle-ch))))
                 (let [drag-events (async+/filter&lt; #(:drag %) dd-events)]
                   (async+m/go-loop [drag-ch drag-events]
                                    (when-let [{:keys [left top]}
                                               (async/&lt;! drag-ch)]
                                      (let [[init-left init-top]
                                           (om/get-state owner :init-location)
                                           [handle-left handle-top]
                                           (om/get-state owner :handle-location)]
                                       (om/set-state! owner :dragging true)
                                       (om/set-state! owner
                                                      :location
                                                      [(+ init-left (- left handle-left))
                                                       (+ init-top (- top handle-top))]))
                                      (recur drag-ch))))
                 (let [drop-events (async+/filter&lt; #(:drop %) dd-events)]
                   (async+m/go-loop [drop-ch drop-events]
                                    (when-let [{:keys [left top]}
                                               (async/&lt;! drop-ch)]
                                      (om/set-state! owner :dragging false)
                                      (recur drop-ch))))))
    om/IWillUnmount
    (will-unmount [_]
                  ((om/get-state owner :unlisten)))
    om/IRenderState
    (render-state [_ state]
                  (let [style (cond
                               (dragging? owner)
                               (let [[x y] (:location state)
                                     [w h] (:dimensions state)]
                                 (js-obj "position" "absolute"
                                         "left" x "top" y
                                         "z-index" 1
                                         "width" w "height" h))
                               :else
                               (js-obj "position" "static" "z-index" 0))]
                    (dom/div
                     (js-obj "className" (if (dragging? owner)
                                           "well dragging"
                                           "well")
                             "style" style
                             "ref" "long-press-draggable")
                     "Long press... Then drag me!")))))
                    </pre>
                    <div id="long-press-dd"></div>
                </div>
            </div>
        </div>




        <script src="resources/js/react-0.8.0.js" type="text/javascript"></script>
        <script src="resources/cljs/goog/base.js" type="text/javascript"></script>
        <script src="resources/cljs/dragdrop.js" type="text/javascript"></script>
        <script type="text/javascript">goog.require("ewen.async_plus");</script>
        <script type="text/javascript">goog.require("ewen.dragdrop");</script>
        <script type="text/javascript">goog.require("ewen.dragdrop.examples");</script>
        <script type="text/javascript">goog.require("ewen.dragdrop");</script>
    </body>
</html>
